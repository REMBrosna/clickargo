{"ast":null,"code":"import _toConsumableArray from \"D:\\\\Collap Projects\\\\ACLEDA-Student\\\\student-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"D:\\\\Collap Projects\\\\ACLEDA-Student\\\\student-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _this = this,\n  _jsxFileName = \"D:\\\\Collap Projects\\\\ACLEDA-Student\\\\student-ui\\\\src\\\\app\\\\views\\\\applications\\\\messagePopUp\\\\PrivateChatPopUpMessage.jsx\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport SockJS from 'sockjs-client';\nimport { Client } from '@stomp/stompjs';\nimport '../../../../styles/privateChatPopUpMessage.css';\nimport useAuth from \"../../../hooks/useAuth\"; // Assuming useAuth is a custom hook for authentication\n\nvar PrivateChatPopUpMessage = function PrivateChatPopUpMessage(_ref) {\n  var popUpUsername = _ref.popUpUsername;\n  var auth = useAuth();\n  var currentUser = auth.user.username; // Get the current logged-in user's username\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isConnected = _useState2[0],\n    setIsConnected = _useState2[1];\n  var _useState3 = useState([]),\n    _useState4 = _slicedToArray(_useState3, 2),\n    messages = _useState4[0],\n    setMessages = _useState4[1];\n  var _useState5 = useState(\"\"),\n    _useState6 = _slicedToArray(_useState5, 2),\n    newMessage = _useState6[0],\n    setNewMessage = _useState6[1]; // State to handle new messages\n  var stompClientRef = useRef(null);\n  useEffect(function () {\n    if (!currentUser || !popUpUsername) return; // Ensure both currentUser and popUpUsername are available\n\n    var token = localStorage.getItem('accessToken');\n\n    // WebSocket connection using SockJS\n    var socket = new SockJS(\"http://localhost:8080/ws?token=\".concat(token));\n\n    // Creating the STOMP client\n    var stompClient = new Client({\n      webSocketFactory: function webSocketFactory() {\n        socket.onopen = function () {\n          // Injecting headers on WebSocket connection\n          socket.send('Authorization', \"Bearer \".concat(token));\n        };\n        return socket;\n      },\n      connectHeaders: {\n        Authorization: \"Bearer \".concat(token) // Include token in the connection headers\n      },\n\n      reconnectDelay: 5000,\n      onConnect: function onConnect() {\n        console.log('✅ Connected');\n        setIsConnected(true); // Set connection status\n\n        // Subscribe to the chat messages\n        stompClient.subscribe(\"/user/\".concat(currentUser, \"/queue/messages\"), function (message) {\n          var msg = JSON.parse(message.body);\n          setMessages(function (prev) {\n            return [].concat(_toConsumableArray(prev), [msg]);\n          });\n        });\n      },\n      onStompError: function onStompError(frame) {\n        console.error('❌ STOMP Error', frame);\n      }\n    });\n\n    // Activate the client\n    stompClient.activate();\n    stompClientRef.current = stompClient;\n\n    // Cleanup on component unmount\n    return function () {\n      if (stompClientRef.current) {\n        stompClientRef.current.deactivate();\n      }\n    };\n  }, [currentUser, popUpUsername]); // Dependencies updated\n\n  // Function to send a message\n  var sendMessage = function sendMessage() {\n    if (newMessage.trim() === \"\") return; // Prevent sending empty messages\n\n    var messagePayload = {\n      sender: currentUser,\n      receiver: popUpUsername,\n      content: newMessage\n    };\n    if (stompClientRef.current && isConnected) {\n      stompClientRef.current.publish({\n        destination: \"/app/private-message\",\n        body: JSON.stringify(messagePayload)\n      });\n\n      // Add the sent message to the UI\n      setMessages(function (prev) {\n        return [].concat(_toConsumableArray(prev), [messagePayload]);\n      });\n\n      // Clear the input field after sending the message\n      setNewMessage(\"\");\n    }\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }\n  }, isConnected && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"status-bar\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 29\n    }\n  }, \"Connected\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"messages-container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }\n  }, messages.map(function (message, index) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: index,\n      className: \"message \".concat(message.sender === currentUser ? 'sent' : 'received'),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"message-header\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 29\n      }\n    }, message.sender), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"message-time\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 29\n      }\n    }, new Date().toLocaleTimeString())), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"message-content\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 25\n      }\n    }, message.content));\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"message-input\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    value: newMessage,\n    onChange: function onChange(e) {\n      return setNewMessage(e.target.value);\n    } // Update newMessage state on input change\n    ,\n    placeholder: \"Type a message...\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendMessage,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 17\n    }\n  }, \"Send\")));\n};\nexport default PrivateChatPopUpMessage;","map":{"version":3,"names":["React","useEffect","useRef","useState","SockJS","Client","useAuth","PrivateChatPopUpMessage","popUpUsername","auth","currentUser","user","username","isConnected","setIsConnected","messages","setMessages","newMessage","setNewMessage","stompClientRef","token","localStorage","getItem","socket","stompClient","webSocketFactory","onopen","send","connectHeaders","Authorization","reconnectDelay","onConnect","console","log","subscribe","message","msg","JSON","parse","body","prev","onStompError","frame","error","activate","current","deactivate","sendMessage","trim","messagePayload","sender","receiver","content","publish","destination","stringify","map","index","Date","toLocaleTimeString","e","target","value"],"sources":["D:/Collap Projects/ACLEDA-Student/student-ui/src/app/views/applications/messagePopUp/PrivateChatPopUpMessage.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport SockJS from 'sockjs-client';\r\nimport { Client } from '@stomp/stompjs';\r\nimport '../../../../styles/privateChatPopUpMessage.css';\r\nimport useAuth from \"../../../hooks/useAuth\"; // Assuming useAuth is a custom hook for authentication\r\n\r\nconst PrivateChatPopUpMessage = ({ popUpUsername }) => {\r\n    const auth = useAuth();\r\n    const currentUser = auth.user.username;  // Get the current logged-in user's username\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [messages, setMessages] = useState([]);\r\n    const [newMessage, setNewMessage] = useState(\"\"); // State to handle new messages\r\n    const stompClientRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        if (!currentUser || !popUpUsername) return; // Ensure both currentUser and popUpUsername are available\r\n\r\n        const token = localStorage.getItem('accessToken');\r\n\r\n        // WebSocket connection using SockJS\r\n        const socket = new SockJS(`http://localhost:8080/ws?token=${token}`);\r\n\r\n        // Creating the STOMP client\r\n        const stompClient = new Client({\r\n            webSocketFactory: () => {\r\n                socket.onopen = () => {\r\n                    // Injecting headers on WebSocket connection\r\n                    socket.send('Authorization', `Bearer ${token}`);\r\n                };\r\n                return socket;\r\n            },\r\n            connectHeaders: {\r\n                Authorization: `Bearer ${token}`, // Include token in the connection headers\r\n            },\r\n            reconnectDelay: 5000,\r\n            onConnect: () => {\r\n                console.log('✅ Connected');\r\n                setIsConnected(true); // Set connection status\r\n\r\n                // Subscribe to the chat messages\r\n                stompClient.subscribe(`/user/${currentUser}/queue/messages`, (message) => {\r\n                    const msg = JSON.parse(message.body);\r\n                    setMessages((prev) => [...prev, msg]);\r\n                });\r\n            },\r\n            onStompError: (frame) => {\r\n                console.error('❌ STOMP Error', frame);\r\n            },\r\n        });\r\n\r\n        // Activate the client\r\n        stompClient.activate();\r\n        stompClientRef.current = stompClient;\r\n\r\n        // Cleanup on component unmount\r\n        return () => {\r\n            if (stompClientRef.current) {\r\n                stompClientRef.current.deactivate();\r\n            }\r\n        };\r\n    }, [currentUser, popUpUsername]); // Dependencies updated\r\n\r\n    // Function to send a message\r\n    const sendMessage = () => {\r\n        if (newMessage.trim() === \"\") return;  // Prevent sending empty messages\r\n\r\n        const messagePayload = {\r\n            sender: currentUser,\r\n            receiver: popUpUsername,\r\n            content: newMessage,\r\n        };\r\n\r\n        if (stompClientRef.current && isConnected) {\r\n            stompClientRef.current.publish({\r\n                destination: \"/app/private-message\",\r\n                body: JSON.stringify(messagePayload),\r\n            });\r\n\r\n            // Add the sent message to the UI\r\n            setMessages((prev) => [...prev, messagePayload]);\r\n\r\n            // Clear the input field after sending the message\r\n            setNewMessage(\"\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"chat-container\">\r\n            {isConnected && <div className=\"status-bar\">Connected</div>}\r\n            <div className=\"messages-container\">\r\n                {messages.map((message, index) => (\r\n                    <div\r\n                        key={index}\r\n                        className={`message ${message.sender === currentUser ? 'sent' : 'received'}`}\r\n                    >\r\n                        <div className=\"message-header\">\r\n                            <strong>{message.sender}</strong>\r\n                            <span className=\"message-time\">{new Date().toLocaleTimeString()}</span>\r\n                        </div>\r\n                        <div className=\"message-content\">{message.content}</div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            <div className=\"message-input\">\r\n                <input\r\n                    type=\"text\"\r\n                    value={newMessage}\r\n                    onChange={(e) => setNewMessage(e.target.value)}  // Update newMessage state on input change\r\n                    placeholder=\"Type a message...\"\r\n                />\r\n                <button onClick={sendMessage}>Send</button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PrivateChatPopUpMessage;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}