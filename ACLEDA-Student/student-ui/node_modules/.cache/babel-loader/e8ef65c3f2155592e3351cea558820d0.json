{"ast":null,"code":"import _objectSpread from \"D:\\\\Collap Projects\\\\ACLEDA-Student\\\\student-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"D:\\\\Collap Projects\\\\ACLEDA-Student\\\\student-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"D:\\\\Collap Projects\\\\ACLEDA-Student\\\\student-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _this = this,\n  _jsxFileName = \"D:\\\\Collap Projects\\\\ACLEDA-Student\\\\student-ui\\\\src\\\\app\\\\views\\\\applications\\\\messagePopUp\\\\UserPopUpMessage.jsx\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Box, Typography, Avatar, TextField, IconButton, Paper } from '@mui/material';\nimport SendIcon from '@mui/icons-material/Send';\nimport { v4 as uuidv4 } from 'uuid';\nvar userId = 1; // Replace with actual logged-in user ID\nvar receiverId = 2; // Replace with actual receiver ID\n\nvar ChatBox = function ChatBox() {\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    messages = _useState2[0],\n    setMessages = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    input = _useState4[0],\n    setInput = _useState4[1];\n  var ws = useRef(null);\n  var bottomRef = useRef(null);\n  useEffect(function () {\n    ws.current = new WebSocket(\"ws://localhost:8080/ws/chat?userId=\".concat(userId));\n    ws.current.onmessage = function (event) {\n      var msg = JSON.parse(event.data);\n      setMessages(function (prev) {\n        return [].concat(_toConsumableArray(prev), [msg]);\n      });\n\n      // Auto-send \"SEEN\" if message is from receiver\n      if (msg.sender === receiverId && msg.type === 'MESSAGE') {\n        ws.current.send(JSON.stringify({\n          type: 'SEEN',\n          sender: userId,\n          receiver: receiverId,\n          id: msg.id\n        }));\n      }\n    };\n    return function () {\n      ws.current.close();\n    };\n  }, []);\n  useEffect(function () {\n    if (bottomRef.current) {\n      bottomRef.current.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }, [messages]);\n  var handleSend = function handleSend() {\n    if (input.trim() !== '') {\n      var msg = {\n        id: uuidv4(),\n        // temporary ID\n        sender: userId,\n        receiver: receiverId,\n        content: input,\n        type: 'MESSAGE',\n        timestamp: new Date().toISOString()\n      };\n      ws.current.send(JSON.stringify(msg));\n      setMessages(function (prev) {\n        return [].concat(_toConsumableArray(prev), [_objectSpread(_objectSpread({}, msg), {}, {\n          state: 'SENT'\n        })]);\n      });\n      setInput('');\n    }\n  };\n  return /*#__PURE__*/React.createElement(Box, {\n    component: Paper,\n    elevation: 3,\n    sx: {\n      p: 2,\n      height: '400px',\n      width: '100%',\n      maxWidth: 500,\n      overflowY: 'auto',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: 1\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }\n  }, messages.map(function (msg, i) {\n    var isMine = msg.sender === userId;\n    return /*#__PURE__*/React.createElement(Box, {\n      key: msg.id || i,\n      sx: {\n        display: 'flex',\n        flexDirection: isMine ? 'row-reverse' : 'row',\n        alignItems: 'flex-end',\n        gap: 1\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Avatar, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 25\n      }\n    }, isMine ? 'Me' : 'U'), /*#__PURE__*/React.createElement(Box, {\n      sx: {\n        bgcolor: isMine ? 'primary.main' : 'grey.300',\n        color: isMine ? 'white' : 'black',\n        px: 2,\n        py: 1,\n        borderRadius: 2,\n        maxWidth: '70%'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(Typography, {\n      variant: \"body2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 29\n      }\n    }, msg.content), /*#__PURE__*/React.createElement(Typography, {\n      variant: \"caption\",\n      sx: {\n        display: 'block',\n        textAlign: 'right'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 29\n      }\n    }, msg.state === 'SEEN' ? 'Seen' : '')));\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    ref: bottomRef,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      mt: 'auto',\n      display: 'flex',\n      alignItems: 'center',\n      gap: 1\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    value: input,\n    onChange: function onChange(e) {\n      return setInput(e.target.value);\n    },\n    fullWidth: true,\n    placeholder: \"Type a message\",\n    onKeyDown: function onKeyDown(e) {\n      return e.key === 'Enter' && handleSend();\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(IconButton, {\n    onClick: handleSend,\n    color: \"primary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(SendIcon, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 21\n    }\n  }))));\n};\nexport default ChatBox;","map":{"version":3,"names":["React","useEffect","useRef","useState","Box","Typography","Avatar","TextField","IconButton","Paper","SendIcon","v4","uuidv4","userId","receiverId","ChatBox","messages","setMessages","input","setInput","ws","bottomRef","current","WebSocket","onmessage","event","msg","JSON","parse","data","prev","sender","type","send","stringify","receiver","id","close","scrollIntoView","behavior","handleSend","trim","content","timestamp","Date","toISOString","state","p","height","width","maxWidth","overflowY","display","flexDirection","gap","map","i","isMine","alignItems","bgcolor","color","px","py","borderRadius","textAlign","mt","e","target","value","key"],"sources":["D:/Collap Projects/ACLEDA-Student/student-ui/src/app/views/applications/messagePopUp/UserPopUpMessage.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport {\r\n    Box,\r\n    Typography,\r\n    Avatar,\r\n    TextField,\r\n    IconButton,\r\n    Paper,\r\n} from '@mui/material';\r\nimport SendIcon from '@mui/icons-material/Send';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nconst userId = 1; // Replace with actual logged-in user ID\r\nconst receiverId = 2; // Replace with actual receiver ID\r\n\r\nconst ChatBox = () => {\r\n    const [messages, setMessages] = useState([]);\r\n    const [input, setInput] = useState('');\r\n    const ws = useRef(null);\r\n    const bottomRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        ws.current = new WebSocket(`ws://localhost:8080/ws/chat?userId=${userId}`);\r\n\r\n        ws.current.onmessage = (event) => {\r\n            const msg = JSON.parse(event.data);\r\n            setMessages((prev) => [...prev, msg]);\r\n\r\n            // Auto-send \"SEEN\" if message is from receiver\r\n            if (msg.sender === receiverId && msg.type === 'MESSAGE') {\r\n                ws.current.send(JSON.stringify({\r\n                    type: 'SEEN',\r\n                    sender: userId,\r\n                    receiver: receiverId,\r\n                    id: msg.id,\r\n                }));\r\n            }\r\n        };\r\n\r\n        return () => {\r\n            ws.current.close();\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (bottomRef.current) {\r\n            bottomRef.current.scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n    }, [messages]);\r\n\r\n    const handleSend = () => {\r\n        if (input.trim() !== '') {\r\n            const msg = {\r\n                id: uuidv4(), // temporary ID\r\n                sender: userId,\r\n                receiver: receiverId,\r\n                content: input,\r\n                type: 'MESSAGE',\r\n                timestamp: new Date().toISOString(),\r\n            };\r\n            ws.current.send(JSON.stringify(msg));\r\n            setMessages((prev) => [...prev, { ...msg, state: 'SENT' }]);\r\n            setInput('');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Box\r\n            component={Paper}\r\n            elevation={3}\r\n            sx={{\r\n                p: 2,\r\n                height: '400px',\r\n                width: '100%',\r\n                maxWidth: 500,\r\n                overflowY: 'auto',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: 1,\r\n            }}\r\n        >\r\n            {messages.map((msg, i) => {\r\n                const isMine = msg.sender === userId;\r\n                return (\r\n                    <Box\r\n                        key={msg.id || i}\r\n                        sx={{\r\n                            display: 'flex',\r\n                            flexDirection: isMine ? 'row-reverse' : 'row',\r\n                            alignItems: 'flex-end',\r\n                            gap: 1,\r\n                        }}\r\n                    >\r\n                        <Avatar>{isMine ? 'Me' : 'U'}</Avatar>\r\n                        <Box\r\n                            sx={{\r\n                                bgcolor: isMine ? 'primary.main' : 'grey.300',\r\n                                color: isMine ? 'white' : 'black',\r\n                                px: 2,\r\n                                py: 1,\r\n                                borderRadius: 2,\r\n                                maxWidth: '70%',\r\n                            }}\r\n                        >\r\n                            <Typography variant=\"body2\">{msg.content}</Typography>\r\n                            <Typography variant=\"caption\" sx={{ display: 'block', textAlign: 'right' }}>\r\n                                {msg.state === 'SEEN' ? 'Seen' : ''}\r\n                            </Typography>\r\n                        </Box>\r\n                    </Box>\r\n                );\r\n            })}\r\n\r\n            <div ref={bottomRef} />\r\n\r\n            <Box sx={{ mt: 'auto', display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                <TextField\r\n                    value={input}\r\n                    onChange={(e) => setInput(e.target.value)}\r\n                    fullWidth\r\n                    placeholder=\"Type a message\"\r\n                    onKeyDown={(e) => e.key === 'Enter' && handleSend()}\r\n                />\r\n                <IconButton onClick={handleSend} color=\"primary\">\r\n                    <SendIcon />\r\n                </IconButton>\r\n            </Box>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default ChatBox;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}